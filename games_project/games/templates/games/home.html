{% extends 'games/base.html' %}
{% load static %}
{% load games_extras %}

{% block title %}Home - Django Games Lab2{% endblock %}

{% block content %}
<div class="text-center">
    <!-- DTL Variables: Dynamic greeting -->
    <h2>
        Welcome to Django Games Lab2! 
        <!-- DTL Filter: Conditional display -->
        {% if user.is_authenticated %}
            Hello, {{ user.first_name|default:user.username }}!
        {% endif %}
        üéØ
    </h2>
    
    <p style="margin: 20px 0; font-size: 18px; color: #666;">
        <!-- DTL Variables: Statistics display -->
        Choose from {{ games.count }} amazing games! 
        {% if total_games_played > 0 %}
            {{ total_games_played }} games played so far by {{ total_players }} players.
        {% endif %}
    </p>
    
    <!-- Games Grid using DTL For Loop and Filters -->
    <div class="games-grid">
        {% for game in games %}
            <div class="game-card" 
                 style="background: linear-gradient(45deg, 
                        {% cycle '#ff9a9e, #fad0c4' '#a8edea, #fed6e3' '#ffecd2, #fcb69f' %});"
                 onclick="location.href='{% url game.name %}'">
                
                <!-- DTL Filter: Custom template filter -->
                <span class="game-icon">{{ game.name|get_emoji_for_game }}</span>
                
                <!-- DTL Variables: Model fields -->
                <h3>{{ game.get_name_display }}</h3>
                <p>{{ game.description }}</p>
                
                <!-- DTL Filters: Difficulty display -->
                <div style="margin: 15px 0;">
                    <strong>Difficulty:</strong> {{ game.difficulty_level|difficulty_stars }}
                </div>
                
                <!-- DTL Filters: Score formatting -->
                <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 15px;">
                    Max Score: {{ game.max_score }} points
                </div>
                
                <a href="{% url game.name %}" class="btn">
                    Play Now
                </a>
            </div>
        {% empty %}
            <!-- DTL Tag: Empty case handling -->
            <div class="alert alert-info">
                No games available at the moment. Please check back later!
            </div>
        {% endfor %}
    </div>
    
    <!-- Statistics Section using DTL Variables and Tags -->
    {% if recent_scores %}
    <div class="stats-container mt-5">
        <h3>üèÜ Recent High Scores</h3>
        <!-- DTL Custom Tag: Top scores -->
        {% get_top_scores limit=10 as top_scores %}
        
        <div class="score-list">
            {% for score in top_scores %}
                <div class="score-item">
                    <div class="player-info">
                        <!-- DTL Inclusion Tag: Score badge -->
                    {% score_badge score.score score.game.max_score %}
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Top Players Section using DTL Variables -->
    {% if top_players %}
    <div class="stats-container mt-4">
        <h3>üëë Top Players</h3>
        <div class="stats-grid">
            {% for player in top_players %}
                <div class="stat-item">
                    <div class="player-avatar" style="margin: 0 auto 10px;">
                        {{ player.name|first|upper }}
                    </div>
                    <strong>{{ player.name }}</strong><br>
                    <!-- DTL Filter: Mathematical operations -->
                    <span class="stat-value">{{ player.total_score }}</span>
                    <span class="stat-label">Total Score</span><br>
                    <small>
                        {{ player.total_games }} game{{ player.total_games|pluralize }} played
                        <!-- DTL Filter: Custom percentage calculation -->
                        (Avg: {{ player.average_score|floatformat:1 }})
                    </small>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
